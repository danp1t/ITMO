<?xml version="1.0" encoding="UTF-8"?>
<!--
  Created by IntelliJ IDEA.
  User: danp1t
  Date: 13.11.2024
  Time: 14:11
-->
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui" xmlns:c="http://java.sun.com/jsp/jstl/core">


<h:head>
    <title>Основная страничка</title>
    <link rel="stylesheet" href="styles.css"/>

</h:head>

<h:body>
    <div id="header">
        <span id="myname">Путинцев Данил Денисович</span>
        <span id="mygroup">P3207</span>
        <span id="variant">Вариант: 430331</span>
    </div>
    <div id="form">
        <h:form>
        <div id="coor_x" class="coors">
            <span class="ui-float-label">
                <p:inputText class="float-input" id="coorXInput" value="#{CoorBean.coorX}" validator="#{CoorBean.validateX}" required="true"/>
                <p:outputLabel for="@previous" value="Координата X"/>
            </span>
            <p:messages for="coorXInput" autoUpdate="true" />
        </div>
        </h:form>
        <div id="coor_y" class="coors">
            <h:form>
                <h:panelGroup id="tabPanel">
                    <h:outputLabel value="Select CoorY: " />

                    <h:panelGrid columns="9">
                        <c:forEach items="#{CoorBean.coorYOptions}" var="option">
                            <h:commandLink value="#{option}" action="#{CoorBean.selectCoorY(option)}" />
                        </c:forEach>
                    </h:panelGrid>
                </h:panelGroup>

                <h:outputText value="Selected CoorY: #{CoorBean.coorY}" />
            </h:form>
        </div>
        <h:form id="RForm">
        <div id="coor_r" class="coors">
            <span class="ui-float-label">
                <p:inputText id="coorRInput" class="float-input" value="#{CoorBean.coorR}" validator="#{CoorBean.validateR}" required="true"/>
                <p:outputLabel for="coorRInput" value="Координата R"/>
            </span>
            <p:messages for="coorRInput" autoUpdate="true" />
        </div>
        </h:form>
        <div id="error_message" style="color: red;">

        </div>
        <div>
            <button type="submit">Отправить</button>
        </div>

    </div>
    <canvas id="canvas" width="400" height="400"> </canvas>
    <script type="text/javascript">

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const scale = 40
        const width = canvas.width;
        const height = canvas.height;
        function drawAxes(R) {

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            let halfR = R / 2;
            ctx.beginPath();
            ctx.moveTo(width / 2, 0);
            ctx.lineTo(width / 2, width); // Ось Y
            ctx.moveTo(0, width / 2);
            ctx.lineTo(width, width / 2); // Ось X
            ctx.stroke();
            ctx.fillStyle = 'black'
            ctx.fillText(-R, width / 2 - R * scale, width / 2 + 15);
            ctx.fillText(R, width / 2 + R * scale, width / 2 + 15);
            ctx.fillText(halfR, width / 2 + halfR * scale, width / 2 + 15);
            ctx.fillText(-halfR, width / 2 - halfR * scale, width / 2 + 15);
            ctx.fillText(-R, width / 2 + 5, width / 2 + R * scale);
            ctx.fillText(R, width / 2 + 5, width / 2 - R * scale);
            ctx.fillText(-halfR, width / 2 + 5, width / 2 + halfR * scale);
            ctx.fillText(halfR, width / 2 + 5, width / 2 - halfR * scale);

            ctx.fillText("y", width / 2 + 5, 8);
            ctx.fillText("x", width - 20, width / 2 + 15);


        }

        function drawShapes(R) {


            // Первая четверть: часть окружности
            ctx.beginPath();
            ctx.arc(width / 2, width / 2, R * scale / 2, -(Math.PI*1.5), -(Math.PI)); // Часть окружности сверху
            ctx.lineTo(width / 2, width / 2);
            ctx.fillStyle = 'rgba(51, 153, 255, 0.5)';
            ctx.fill();
            ctx.stroke();

            // Вторая четверть: прямоугольник
            ctx.beginPath();
            ctx.rect(width / 2, width / 2, R * scale / 2,  R * scale);
            ctx.fillStyle = 'rgba(51, 153, 255, 0.5)';
            ctx.fill();
            ctx.stroke();

            // Третья четверть: треугольник
            ctx.beginPath();
            ctx.moveTo(width / 2 - R * scale, width / 2);
            ctx.lineTo(width / 2, width / 2 - R * scale);
            ctx.lineTo(width / 2, width / 2);
            ctx.closePath();
            ctx.fillStyle = 'rgba(51, 153, 255, 0.5)';
            ctx.fill();
            ctx.stroke();

        }


        document.getElementById('RForm:coorRInput').addEventListener('change', function() {
            const R = parseFloat(this.value);
            const errorMessageDiv = document.getElementById('error_message');
            errorMessageDiv.textContent = ''

            drawAxes(R);
            drawShapes(R);
        });

        // Инициализация с начальным значением R
        const R = parseFloat(document.getElementById('RForm:coorRInput').value);
        drawAxes(R);
        drawShapes(R);


        canvas.addEventListener('click', function(event) {
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left; // Получаем координату X
            const y = event.clientY - rect.top; // Получаем координату Y

            // Преобразуем координаты в систему координат вашей области
            const scaledX = (x - 200) / 60; // Масштабируем по X
            const scaledY = (200 - y) / 60; // Масштабируем по Y

            const rValue = document.getElementById('RForm:coorRInput').value;

            const errorMessageDiv = document.getElementById('error_message');
            errorMessageDiv.textContent = ''; // Сбрасываем сообщение об ошибке

            if (rValue === '') {
                errorMessageDiv.textContent = 'Выберете значение R';
                return; // Прерываем выполнение, если есть ошибка
            }

            // Отправляем данные на сервер
            $.ajax({
                url: '/fcgi-bin/lab1.jar',
                method: 'GET',
                dataType: 'html',
                data: {
                    coor_x: scaledX,
                    coor_y: scaledY,
                    coor_r: parseFloat(document.getElementById('coor_r-select').value)
                },
                success: function(data, textStatus, jqXHR) {
                    document.getElementById('resultTable').innerHTML = data;
                }
            });

        });
    </script>
</h:body>

</html>